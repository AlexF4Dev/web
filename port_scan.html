
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
<title>Port Scanning Local Network From a Web Browser</title>
<meta name="description" content="Malicious web pages can port scan your local network." />
<meta name="keywords" content="browser, port scan, security" />
<meta name="google-site-verification" content="LjgndE9fyTkxbPz8aMFyJQFSS3cQiXIrYchE_b2VXlg" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript" src="/js/upvote.js"></script>
<link rel="stylesheet" media="all" type="text/css" href="/main.css" />
<link rel="stylesheet" media="all" type="text/css" href="/mainmenu.css" />
<link rel="stylesheet" media="all" type="text/css" href="/vimhl.css" />
<link rel="stylesheet" media="print" type="text/css" href="/print.css" />
<!--[if !IE 7]>
	<style type="text/css">
		#wrap {display:table;height:100%}
	</style>
<![endif]-->
</head>
<body  >
<div id="wrap">

<!-- This menuing system was made by Steve Gibson at GRC.COM 
            see more at http://www.grc.com/menudemo.htm -->


<div class="menuminwidth0"><div class="menuminwidth1"><div class="menuminwidth2">
<div id="masthead">
    <div style="font-size:30px;"><img src="/images/1by1.gif" alt="Defuse Security Research and Development" /></div>
    <div id="sm">
        <a href="https://twitter.com/defusesec" title="Follow @DefuseSec on twitter!">
            <img id="twitterlogo" src="/images/twitter.png" alt="Follow me on twitter!" height="25" width="30" />
            Twitter
        </a>
        &nbsp;&middot;&nbsp;
        <a href="https://github.com/defuse" title="Defuse Security's GitHub">GitHub</a>
    </div>
</div>

<div class="menu">

<ul>
    <li class="headerlink" ><a href="/">Home<img class="downimg" src="/images/downarrow.gif" alt="&#9660;"/><!--[if gt IE 6]><!--></a><!--<![endif]--><!--[if lt IE 7]><table border="0" cellpadding="0" cellspacing="0"><tr><td><![endif]-->
        <ul class="leftbutton">
            <li><a href="/about.htm">&nbsp;About Defuse</a></li>
            <li><a href="/contact.htm">&nbsp;Contact</a></li>
            <li><a href="/security-contact-vulnerability-disclosure.htm">&nbsp;Vulnerability Disclosure</a></li>
            <li><a href="https://bqp.io/" >&nbsp;Blog</a></li>
            <li><a href="https://twitter.com/#!/defusesec" >&nbsp;Twitter</a></li>
            <li><a href="https://github.com/defuse" >&nbsp;GitHub</a></li>
            <li><a href="https://z.cash/">&nbsp;Zcash (Zerocash)</a></li>
        </ul>
        <!--[if lte IE 6]></td></tr></table></a><![endif]-->
    </li>
</ul>

<ul>
    <li class="headerlink" ><a href="/services.htm">Services<img class="downimg" src="/images/downarrow.gif" alt="&#9660;"/><!--[if gt IE 6]><!--></a><!--<![endif]--><!--[if lt IE 7]><table border="0" cellpadding="0" cellspacing="0"><tr><td><![endif]-->
        <ul>
            <li><a href="/software-security-auditing.htm">&nbsp;Security Auditing</a></li>
            <li><a href="/pastebin.htm">&nbsp;Encrypted Pastebin</a></li>
            <li><a href="/quantum-computer-time-capsule.htm">&nbsp;Time Capsule</a></li>
            <li><a href="/trustedthirdparty.htm">&nbsp;TRENT - Trusted RNG</a></li>
            <li><a href="/big-number-calculator.htm">&nbsp;Big Number Calculator</a></li>
            <li><a href="/online-x86-assembler.htm">&nbsp;Online x86 Assembler</a></li>
            <li><a href="/checksums.htm">&nbsp;Checksum Calculator</a></li>
            <li><a href="/html-sanitize.htm">&nbsp;HTML Sanitizer</a></li>
            <li><a href="http://crackstation.net/">&nbsp;CrackStation.net</a></li>
        </ul>
    <!--[if lte IE 6]></td></tr></table></a><![endif]-->
    </li>
</ul>

<ul>
    <li class="headerlink" ><a href="/projects.htm">Software<img class="downimg" src="/images/downarrow.gif" alt="&#9660;"/><!--[if gt IE 6]><!--></a><!--<![endif]--><!--[if lt IE 7]><table border="0" cellpadding="0" cellspacing="0"><tr><td><![endif]-->
        <ul>
            <li><a href="/passgen.htm">&nbsp;Password Generator</a></li>
            <li><a href="/helloworld-cms.htm">&nbsp;HelloWorld! Secure CMS</a></li>
            <li><a href="/php-hash-cracker.htm">&nbsp;PHP Hash Cracker</a></li>
            <li><a href="/backup-verify-script.htm">&nbsp;Backup Checker</a></li>
        </ul>
        <!--[if lte IE 6]></td></tr></table></a><![endif]-->
    </li>
</ul>

<ul>
    <li class="headerlink" ><a href="/projects.htm">Projects &amp; Code<img class="downimg" src="/images/downarrow.gif" alt="&#9660;"/><!--[if gt IE 6]><!--></a><!--<![endif]--><!--[if lt IE 7]><table border="0" cellpadding="0" cellspacing="0"><tr><td><![endif]-->
        <ul>
            <li><a href="/web-browser-negative-feedback.htm">&nbsp;Insecure Feedback</a></li>
            <li><a href="/bochs-images.htm">&nbsp;Bochs Disk Images</a></li>
            <li><a href="/gnutls-psk-client-server-example.htm">&nbsp;GnuTLS PSK Example</a></li>
            <li><a href="/secure-php-encryption.htm">&nbsp;Encryption in PHP</a></li>
            <li><a href="/email-spoofing-in-ruby.htm">&nbsp;Ruby Email Spoofing</a></li>
            <li><a href="/syntax-highlighting-in-php-with-vim.htm">&nbsp;PHP &amp; Vim Highlighting</a></li>
            <li><a href="/php-hit-counter.htm">&nbsp;PHP Hit Counter</a></li>
            <li><a href="/generating-random-passwords.htm">&nbsp;PHP Random Passwords</a></li>
            <li><a href="/php-pbkdf2.htm">&nbsp;PBKDF2 For PHP</a></li>
            <li><a href="/force-print-background.htm">&nbsp;Force Print BG Color</a></li>
        </ul>
        <!--[if lte IE 6]></td></tr></table></a><![endif]-->
    </li>
</ul>

<ul>
    <li class="headerlink" ><a href="/projects.htm">Research<img class="downimg" src="/images/downarrow.gif" alt="&#9660;"/><!--[if gt IE 6]><!--></a><!--<![endif]--><!--[if lt IE 7]><table border="0" cellpadding="0" cellspacing="0"><tr><td><![endif]-->
        <ul>
            <li><a href="#"><span class="drop"><span>Vulns &amp; Exploits</span>&raquo;</span><!--[if gt IE 6]><!--></a><!--<![endif]--><!--[if lt IE 7]><table border="0" cellpadding="0" cellspacing="0"><tr><td><![endif]-->
                <ul>
                    <li><a href="/side-channel-attacks-on-everyday-applications.htm">Side Channels (BHUSA 2016)</a></li>
                    <li><a href="/in-browser-port-scanning.htm">&nbsp;Browser Port Scanner</a></li>
                    <li><a href="/sockstress.htm">&nbsp;Sockstress</a></li>
                    <li><a href="/instruction-filters.htm">&nbsp;Instruction Filters</a></li>
                    <li><a href="/flush-reload-side-channel.htm">&nbsp;FLUSH+RELOAD</a></li>
                    <li><a href="/exploiting-cpp-vtables.htm">&nbsp;C++ VTABLES</a></li>        
                    <li><a href="/cracking-synergy-bad-cryptography.htm">&nbsp;Cracking Synergy</a></li>
                    <li><a href="/mitigating-breach-tls-attack-in-php.htm">&nbsp;PHP BREACH Defense</a></li>
                    <li><a href="/race-conditions-in-web-applications.htm">&nbsp;Race Conditions</a></li>        
                    <li><a href="/filesystem-events-ntfs-permissions.htm">&nbsp;File-System Events</a></li>
                    <li><a href="/onedetection.htm">&nbsp;PUP Confusion</a></li>
                    <li><a href="/side-channels-in-encoding-functions.htm">&nbsp;Encoding Side Channels</a></li>
                </ul>

                <!--[if lte IE 6]></td></tr></table></a><![endif]-->
            </li>
            <li><a href="#"><span class="drop"><span>Crypto</span>&raquo;</span><!--[if gt IE 6]><!--></a><!--<![endif]--><!--[if lt IE 7]><table border="0" cellpadding="0" cellspacing="0"><tr><td><![endif]-->
                <ul>
                    <li><a href="/blind-birthday-attack.htm">&nbsp;Blind Birthday Attack</a></li>
                    <li><a href="/manual-random-number-generator.htm">&nbsp;Paper Coin TRNG</a></li>
                    <li><a href="/cbcmodeiv.htm">&nbsp;CBC Mode IV Security</a></li>
                    <li><a href="/eotp.htm">&nbsp;EOTP</a></li>
                    <li><a href="/truecrypt-plausible-deniability-useless-by-game-theory.htm">&nbsp;TrueCrypt &amp; Game Theory</a></li>        
                    <li><a href="/web-browser-javascript-cryptography.htm">&nbsp;Browser Cryptography</a></li>        
                </ul>

                <!--[if lte IE 6]></td></tr></table></a><![endif]-->
            </li>        
            <li><a href="#"><span class="drop"><span>Passwords</span>&raquo;</span><!--[if gt IE 6]><!--></a><!--<![endif]--><!--[if lt IE 7]><table border="0" cellpadding="0" cellspacing="0"><tr><td><![endif]-->
                <ul>
                    <li><a href="/password-hashing-after-phc.htm">&nbsp;Hash Caching</a></li>
                    <li><a href="/password-policy-hall-of-shame.htm">&nbsp;Password Hall of Shame</a></li>        
                    <li><a href="http://crackstation.net/hashing-security.html">&nbsp;Salted Password Hashing</a></li>
                </ul>

                <!--[if lte IE 6]></td></tr></table></a><![endif]-->
            </li>        
            <li><a href="#"><span class="drop"><span>Audits</span>&raquo;</span><!--[if gt IE 6]><!--></a><!--<![endif]--><!--[if lt IE 7]><table border="0" cellpadding="0" cellspacing="0"><tr><td><![endif]-->
                <ul>
                    <li><a href="/audits/encfs.htm">&nbsp;EncFS</a></li>
                    <li><a href="/audits/ecryptfs.htm">&nbsp;eCryptfs</a></li>
                    <li><a href="/audits/zerobin.htm">&nbsp;ZeroBin</a></li>
                    <li><a href="/audits/pefs.htm">&nbsp;PEFS</a></li>
                    <li><a href="/audits/hash0.htm">&nbsp;Hash0</a></li>
                    <li><a href="/audits/gocryptfs.htm">&nbsp;Gocryptfs</a></li>
                    <li><a href="https://leastauthority.com/blog/least_authority_performs_security_audit_for_globaleaks.html">&nbsp;GlobaLeaks</a></li>
                </ul>

                <!--[if lte IE 6]></td></tr></table></a><![endif]-->
            </li>
            <li><a href="#"><span class="drop"><span>Theory</span>&raquo;</span><!--[if gt IE 6]><!--></a><!--<![endif]--><!--[if lt IE 7]><table border="0" cellpadding="0" cellspacing="0"><tr><td><![endif]-->
                <ul>
                    <li><a href="/concentration-bounds-from-parallel-repetition-theorems.htm">&nbsp;My Master's Thesis</a></li>
                    <li><a href="/how-do-we-model-this-robot.htm">&nbsp;Robot Modelling</a></li>
                    <li><a href="/is-security-local.htm">&nbsp;Is Security Local?</a></li>
                    <li><a href="/plausible-reason-p-noteq-np-is-hard-to-prove.htm">&nbsp;Why It's Hard To Prove P!=NP</a></li>
                </ul>

                <!--[if lte IE 6]></td></tr></table></a><![endif]-->
            </li>        
            <li><a href="#"><span class="drop"><span>Other</span>&raquo;</span><!--[if gt IE 6]><!--></a><!--<![endif]--><!--[if lt IE 7]><table border="0" cellpadding="0" cellspacing="0"><tr><td><![endif]-->
                <ul>
                    <li><a href="/triangle-of-secure-code-delivery.htm">&nbsp;Secure Code Delivery</a></li>
                    <li><a href="/bochs-hacking-guide.htm">&nbsp;Hacking Bochs</a></li>
                    <li><a href="/web-application-security.htm">&nbsp;Website Security</a></li>        
                    <li><a href="/bitcoin-pool-ddos.htm">&nbsp;BitCoin Centralization</a></li>
                    <li><a href="/microsoft-reads-your-skype-messages.htm">&nbsp;Skype Spying</a></li>        
                </ul>

                <!--[if lte IE 6]></td></tr></table></a><![endif]-->
            </li>        
        </ul>
        <!--[if lte IE 6]></td></tr></table></a><![endif]-->
    </li>
</ul>

<ul>
    <li class="headerlink" ><a href="/projects.htm">Miscellaneous<img class="downimg" src="/images/downarrow.gif" alt="&#9660;"/><!--[if gt IE 6]><!--></a><!--<![endif]--><!--[if lt IE 7]><table border="0" cellpadding="0" cellspacing="0"><tr><td><![endif]-->
        <ul>
            <li><a href="/advice-to-aspiring-computer-engineers.htm">&nbsp;Advice for CS Students</a></li>
            <li><a href="/new-york-times-algebra.htm">&nbsp;NYT Algebra</a></li>
            <li><a href="/transparency.htm">&nbsp;Transparency</a></li>
            <li><a href="/reading-list.htm">&nbsp;Reading List</a></li>
            <li><a href="/x-plane-combat.htm">&nbsp;X-Plane Combat</a></li>
            <li><a href="/the-universe-is-made-of-cheese.htm">&nbsp;Cheese Universe</a></li>
            <li><a href="/vimrc.htm">&nbsp;My Vim Configuration</a></li>
            <li><a href="/asuskeyboarddefect.htm">&nbsp;ASUS G51 Keyboard</a></li>
            <li><a href="/honestyware.htm">&nbsp;Honestyware</a></li>
            <li><a href="/online-free-computer-science-education.htm">&nbsp;CS Education</a></li>
            <li><a href="/rules-for-working-with-me.htm">&nbsp;Working With Me</a></li>
            <li><a href="/contributors.htm">&nbsp;Contributors</a></li>
            <li><a href="/centripetal-acceleration.htm">&nbsp;Centripetal Accel.</a></li>
            <li><a href="#"><span class="drop"><span>Mirrors</span>&raquo;</span><!--[if gt IE 6]><!--></a><!--<![endif]--><!--[if lt IE 7]><table border="0" cellpadding="0" cellspacing="0"><tr><td><![endif]-->
                <ul>
                    <li><a href="/pocorgtfo.htm">&nbsp;PoC || GTFO Mirror</a></li>
                    <li><a href="/truecrypt-7.1a-hashes.htm">&nbsp;TrueCrypt Hashes</a></li>
                </ul>

                <!--[if lte IE 6]></td></tr></table></a><![endif]-->
            </li>        
        </ul>
        <!--[if lte IE 6]></td></tr></table></a><![endif]-->
    </li>
</ul>


</div> <!-- close "menu" div -->
<hr style="display:none" />
</div></div></div> <!-- close the "minwidth" wrappers -->
<!-- End of menu -->

<!--[if !IE]>-->
<div id="undergrad"></div>
<!--<![endif]-->

<!--[If gt IE 6]>
<div id="undergrad"></div>
<![endif]-->

<div id="content" >            <div class="upvotearrows">
                    <div class="upvoteuparrow">
            <form 
                action="https://defuse.ca:443/in-browser-port-scanning.htm" 
                method="post"
                onsubmit="return upvote.submit('inbrowserportscanner', 'up')"
                class="upvoteform upvoteUpForminbrowserportscanner"
            >
                <input type="hidden" name="upvotes_direction" value="up" />
                <input type="hidden" name="upvotes_id" value="inbrowserportscanner" />
                                    <input
                        type="image" src="/images/upvote.gif" alt="Upvote"
                        name="upvoteUpImageinbrowserportscanner"
                    />
                            </form>
        </div>
            <div class="upvotecount upvoteCounterinbrowserportscanner" >
            1495 
        </div>
            <div class="upvotedownarrow">
            <form 
                action="https://defuse.ca:443/in-browser-port-scanning.htm" 
                method="post"
                onsubmit="return upvote.submit('inbrowserportscanner', 'down')"
                class="upvoteform upvoteDownForminbrowserportscanner"
            >
                <input type="hidden" name="upvotes_direction" value="down" />
                <input type="hidden" name="upvotes_id" value="inbrowserportscanner" />
                                    <input 
                        type="image" src="/images/downvote.gif" alt="Downvote"
                        name="upvoteDownImageinbrowserportscanner"
                    />
                            </form>
        </div>
                </div>
        <div class="pagedate">
April 12, 2015
</div>
<h1>
Timing Side Channel &quot;Port Scanner&quot; in the Browser
</h1>

<p>
Here is a TCP &quot;port scanner&quot; that works from inside your browser. It
can scan your local network! Actually, it is not <em>really</em> a port scanner,
because it can only distinguish between the following two cases:
</p>


<ol>
    <li>The port is open <em>or</em> the port is closed and responds right away with a TCP RST or ICMP Destination Unreachable packet.</li>
    <li>The port is &quot;stealthed&quot; <em>or</em> the port is open and hangs when it receives an HTTP request <em>or</em> there isn't a host at that IP address at all.</li>
</ol>

<p>
So it is more correct to say that it scans for the presence of a host at an IP
address, but it can be used as a port scanner if all the ports of
a known-to-exist host are &quot;stealthed&quot; except for the open ones.
</p>

<p>
The scanner works by timing how long it takes your browser to give up trying to
load a nonexistent image file. If it fails fast, it's Case 1. If it fails
slowly, it's Case 2. This page uses 1500 milliseconds as the cutoff time, which
works well in all the testing I've done. View this page's source code to see
exactly how it works.
<p>

<p>
Note: The scanner will not work if you have the NoScript Firefox extension and
its ABE feature is enabled (see below). It also doesn't work with every port.
For example, Firefox seems to know not to send requests to ports for other
well-known services, like port 22 (SSH) or 110 (POP). At the very least, it
works reliably with port 80 (HTTP) and 443 (HTTPS).
</p>

<div style="border: solid black 5px; border-radius: 10px; background-color: #AADDFF; padding-left: 20px; padding-right: 20px;
padding-bottom: 20px;">


    <p>
        <strong>Local Network Scan (Proof of Concept)</strong>
    </p>

    <form>
        <input type="button" id="lan_button" value="Scan 192.168.1.* port 80" onclick="lan_scan(this.form);" />
        <input type="button" id="lan_button_stop" value="Stop Scan" onclick="lan_stop(this.form);" disabled="disabled"/>
    </form>

    <div id="lan_results" style="padding-top: 10px;"></div>

    <p>
        <strong>Custom Scan</strong>
    </p>

    <form>
        <table>
            <tr>
                <td>IP Address:&nbsp;&nbsp;</td>
                <td><input type="text" name="custom_ipaddr" value="192.168.1.1"></input></td>
            </tr>
            <tr>
                <td>Port:</td>
                <td><input type="text" name="custom_port" value="80"></input></td>
            </tr>
            <tr>
                <td></td>
                <td style="text-align: right;">
                    <input type="button" value="Scan" id="custom_button" onclick="custom_scan(this.form);" />
                </td>
            </tr>
        </table>
    </form>

    <div id="custom_result"></div>

</div>

<div id="testdiv" style="visibility: hidden"></div>

<script>

    /* The scanner needs these global variables for an ugly hack. */
    var last_scanobj_index = 0;
    var scanobjs = {};
    function PortScanner(ip, port)
    {
        
        this.ip = ip;
        this.port = port;
        this.on_open_or_closed = null;
        this.on_stealthed = null;
        this.start_time = null;
        this.timed_out = null;
        this.total_time = null;

        this.run = function () {
            /* Check that the client gave us all the callbacks we need. */
            if (this.on_open_or_closed == null) {
                alert("Please set the on_open_or_closed callback!");
            }
            if (this.on_stealthed == null) {
                alert("Please set the on_stealthed callback!");
            }

            /* Save this object in the global directory (UGLY HACK). */
            var our_scanobj_index = last_scanobj_index;
            last_scanobj_index++;
            scanobjs[our_scanobj_index] = this;

            /* Record the starting time. */
            this.start_time = (new Date()).getTime();

            /* Create the div to load the image, passing our object's index into
                the global directory so that it can be retrieved. */
            document.getElementById("testdiv").innerHTML = '<img src="http://' + ip + ':' + port + 
                '" alt="" onerror="error_handler(' + our_scanobj_index + ');" />';

            // XXX: What's the right way to do this in JS?
            var thiss = this;
            setTimeout(
                function () {
                    /* This will be non-null if the event hasn't fired yet. */
                    if (scanobjs[our_scanobj_index]) {
                        scanobjs[our_scanobj_index] = null;
                        thiss.timed_out = true;
                        thiss.on_stealthed();
                    }
                },
                10000
            );
        }
    }

    function error_handler(index)
    {
        /* Get the PortScanner object back. */
        var thiss = scanobjs[index];

        /* If it's null, the scan timed out. */
        if (thiss == null) {
            return;
        }
        /* Set it to null so the timeout knows we handled it. */
        scanobjs[index] = null;
        thiss.timed_out = false;

        /* Measure the amount of time it took for the load to fail. */
        thiss.total_time = (new Date()).getTime() - thiss.start_time;

        /* Call the appropriate callback. */
        if (thiss.total_time < 1500) {
            thiss.on_open_or_closed();
        } else {
            thiss.on_stealthed();
        }
    }

    function custom_scan(form)
    {
        var ip = form.custom_ipaddr.value;
        var port = form.custom_port.value;
        var ip_addr_re = /^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/;

        var match = ip_addr_re.exec(ip);
        if ( match == null ) {
            alert("That isn't a valid IPv4 address.");
            return;
        }

        if (match[1] > 255 || match[2] > 255 || match[3] > 255 || match[4] > 255) {
            alert("That isn't a valid IPv4 address.");
        }

        port = parseInt(port);
        if (isNaN(port) || port < 0 || port > 65535) {
            alert("Bad port number");
        }

        document.getElementById("custom_button").disabled = true;
        document.getElementById("custom_result").innerHTML = "Scanning... This will take up to 10 seconds.";

        var scanner = new PortScanner(ip, port);

        scanner.on_stealthed = function () {
            if (scanner.timed_out) {
                document.getElementById("custom_result").innerHTML = "Case 2 (no response after 10s).";
            } else {
                document.getElementById("custom_result").innerHTML = "Case 2 (" + this.total_time + " ms).";
            }
            document.getElementById("custom_button").disabled = false;
        }

        scanner.on_open_or_closed = function () {
            document.getElementById("custom_result").innerHTML = "Case 1 (" + this.total_time + " ms)."
            document.getElementById("custom_button").disabled = false;
        }

        scanner.run();
    }

    /* This variable keeps track of which 192.168.1 IP to scan next. */
    var current_octet;
    var stop;
    function lan_scan(form)
    {
        document.getElementById("lan_button").disabled = true;
        document.getElementById("lan_button_stop").disabled = false;

        /* Skip .1 since it might visibly prompt for a password. */
        current_octet = 2;
        stop = false;

        var scanner = new PortScanner("192.168.10." + current_octet, 80);
        scanner.on_stealthed = lan_on_stealthed;
        scanner.on_open_or_closed = lan_on_open_or_closed;
        scanner.run();

        document.getElementById("lan_results").innerHTML = "Scanning... <br />";
    }

    function lan_stop(form)
    {
        stop = true;
        document.getElementById("lan_button").disabled = false;
        document.getElementById("lan_button_stop").disabled = true;
    }

    function lan_on_stealthed()
    {
        var res_div = document.getElementById("lan_results");
        res_div.innerHTML += "192.168.1." + current_octet + ": ";
        if (this.timed_out) {
            res_div.innerHTML += "Case 2 (no response after 10 seconds). <br />";
        } else {
            res_div.innerHTML += "Case 2 (" + this.total_time + " ms). <br />";
        }

        current_octet += 1;

        if (stop || current_octet >= 255) {
            res_div.innerHTML += "Done. <br />";
            document.getElementById("lan_button").disabled = false;
            document.getElementById("lan_button_stop").disabled = true;
            return;
        }

        var scanner = new PortScanner("192.168.1." + current_octet, 80);
        scanner.on_stealthed = lan_on_stealthed;
        scanner.on_open_or_closed = lan_on_open_or_closed;
        scanner.run();
    }

    function lan_on_open_or_closed()
    {
        var res_div = document.getElementById("lan_results");
        res_div.innerHTML += "192.168.1." + current_octet + ": ";
        res_div.innerHTML += "Case 1 (" + this.total_time + " ms). <br />";

        current_octet += 1;

        if (stop || current_octet >= 255) {
            res_div.innerHTML += "Done. <br />";
            document.getElementById("lan_button").disabled = false;
            document.getElementById("lan_button_stop").disabled = true;
            return;
        }

        var scanner = new PortScanner("192.168.1." + current_octet, 80);
        scanner.on_stealthed = lan_on_stealthed;
        scanner.on_open_or_closed = lan_on_open_or_closed;
        scanner.run();
    }

</script>

<h2>Why is this a problem?</h2>

<p>
I don't think this is a very big deal, but there are a few reasons you might not
want it to be possible:
</p>

<ol>
    <li>
        If you visit an attacker's website, they can use your connection to port
scan another host on the Internet as part of an attack. Since the scan came from
your connection, you might get blamed.
    </li>
    <li>
        <p>
        Websites you visit can get a little bit of information about what you
        have running on your local network, which might help if they want to
        attack you later.
        </p>
    </li>
    <li>
        <p>
        If you have a highly unique local network, then it can be used as
        a kind of &quot;supercookie&quot; to help track you online. This is
        probably impractical because scanning takes a long time.
        </p>
    </li>
    <li>
        <p>
        <b>Tor and Tails users:</b> This scanner does not work in the Tor
Browser Bundle. However it <em>does</em> work in Tails 1.3.2, and could
potentially be used to deanonymize you.
        </p>

        <p>
        For example, if you have a printer with an open web administration page
on your local network, a website you visit could scan your network for printers,
then fingerprint them (e.g. by requesting known image URLs for common brands of
printers), potentially learning the make, model, and firmware version of your
printer.
        </p>

        <p>
        I emailed Tails about this on April 7, 2015, their response, as of May
        26, 2015, is:
        <p>

        <blockquote>
            <p>
                    My understanding is that this will be fixed once <a
        href="https://labs.riseup.net/code/issues/7976">https://labs.riseup.net/code/issues/7976</a>
        is resolved. This is being worked on for Tails 1.4.1.
            </p>
        </blockquote>

        <p>
    <b>Mitigation:</b> To prevent this scanner from working in the latest version of Tails
(1.3.2), simply remember to enable NoScript's ABE feature every time you boot
Tails. NoScript is installed by default in Tails, but ABE is disabled for some
reason.
        </p>
    </li>
</ol>

<h2>Which browsers and operating systems are affected?</h2>

<p>
I've tested this and found it to work on the following systems:
</p>

<ul>
    <li>Firefox 37.0 on Arch Linux</li>
    <li>Chromium 41.0.2272.118 on Arch Linux</li>
    <li>Opera 28.0 on Arch Linux</li>
    <li>Firefox 37.0 on Windows XP</li>
    <li>Google Chrome 41.0.2272.118 on Windows XP</li>
    <li>Internet Explorer 8.0.6001.18702 on Windows XP</li>
    <li>Opera 27.0.1689.66 on Windows XP</li>
    <li>Internet Explorer 11.0.9600.17501 on Windows 7</li>
    <li>Firefox on Android 5.1</li>
    <li>Chrome on Android 5.1</li>
</ul>

<h2>How do I protect myself?</h2>

<p>
Unfortunately, I don't know of an easy way to stop websites from using your
browser to scan the <em>public Internet</em>, except for turning off JavaScript.
Browsers will have to add an artificial delay to make Case 1 look like Case 2.
</p>

<p>
To stop websites from scanning your <em>local network</em>, all your browser
needs to do is deny any request from an Internet web page to a local IP address.
If you use Firefox, the NoScript extension will do this for you. NoScript's main
purpose is to disable JavaScript, but it has a lot of extra security features,
and that is one of them. Make sure you have the Application Boundaries Enforcer
(ABE) feature turned on.
</p>

<p>
I'm not aware of any Chrome or Internet Explorer extensions that block local
requests. If you know of one, let me know and I will add it here.
</p>


</div>
</div> <!-- Wrap -->
        <div id="footerwrapper">
        <div id="footerborder"></div>
        <div id="footer">

        <div style="float: right;">
        <table>
            <tr>
                <th>Your IP:</th>
                <td>
                100.15.112.198                </td>
            </tr>
            <tr>
                <th>DNT Header:&nbsp;&nbsp;&nbsp;</th>
                <td>Disabled</td>            </tr>
        </table>
        </div>

                <table>
            <tr>
                <th>Page Hits:</th>
                <td>66818</td>
            </tr>
            <tr>
                <th>Unique Hits:</th>
                <td>38684</td>
            </tr>
        </table>
<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0; vertical-align: bottom;" src="/images/cc-by-sa.png" /></a>
         <a href="/about.htm">Defuse Security</a> | 
        <a href="/pastebin.htm">Secure Pastebin</a> | 
        <a href="/passgen.htm">Password Generator</a> |
        <a href="http://crackstation.net/" rel="external">&raquo; CrackStation</a>
        </div> <!-- end footer -->
        </div> <!-- footerwrapper -->
        <!-- Piwik -->
<!-- disabled piwik/matomo temporarily cuz it's broken
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u=(("https:" == document.location.protocol) ? "https" : "http") + "://defuse.ca/piwik/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
    g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();

</script>
<noscript><p><img src="https://defuse.ca/piwik/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
-->
<!-- End Piwik Code -->

</body>
</html>
